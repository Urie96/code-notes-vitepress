---
title: 计算机组成原理小抄
date: 2021-01-05 10:28:21 GMT+0800
categories: [基础]
tags: []
---

## 32 位 vs 64 位

- 图灵机给出了计算机的工作原理，但没有给出实现，并提出了哪些问题可以被计算
- 冯诺伊曼遵循图灵机提出了实现，分为 5 部分：输入、输出、内存、中央处理、总线
- CPU 和内存之间有地址总线、数据总线、控制总线
  - CPU 用地址总线来指定将从内存的哪块地址取出数据
  - 用数据总线来读写数据
  - 控制总线用来收发关键信号，如中断、复位等
- CPU 有 32 位和 64 位
  - 32 位 CPU 有 32 根地址总线，能寻址 **2<sup>32</sup> = 4G** 的内存地址。64 位 CPU 有 40 根地址总线，可寻址 1T
  - 寄存器存储 32 位，意味着一次只能处理 32 位数据，如果想处理`int64`这种 64 位数据，需要算法将其拆为 32 位，但这并不代表 64 位快很多，因为对于大部分数据 32 位已经足够了
- CPU 需要寄存器用于直接存储数据，内存中的数据需要先放到寄存器才能被 CPU 处理
  - 通用寄存器：用于用户编程，比如两数相加需要先将这两数放到通用寄存器
  - 特殊寄存器：PC 指针存下一条指令的**地址**
  - 指令寄存器：存下一条指令

## CPU 指令周期

- 汇编中的一条指令可以用 32 位表示，左边 6 位表示操作码，如`add`、`load`，后面的是该操作码的参数，比如寄存器、内存地址、数值等
- 指令周期：由 PC 指针存储下一条指令地址并读取 -> CPU 解析指令 -> CPU 执行指令 -> 计算结果存入寄存器或者内存。所以一条指令通常需要 2~6 个时钟周期。

## 函数

- CPU 有个栈指针 SP(Stack Pointer)指向栈顶
- 调用函数时，先压栈返回值 0（用于占位），再压栈返回地址（函数调用完成后要返回的指令位置），然后压栈函数参数，最后执行跳转。之所以这样设计顺序，是因为函数调用中可能会有其他函数调用，这样可以让出栈顺序和数据使用顺序保持一致。先根据参数完成运算获得返回值，参数出栈，SP 指向返回地址，返回到函数调用处后，返回地址出栈，SP 指向函数返回值，这时函数调用处就能直接在栈顶取得函数返回值，并且和调用之前的堆栈上下文保持一致。
- 按照上面的思路，可以将所有的递归转换为循环，但需要一个栈来保存参数及返回值

## 存储

- 计算机里的线路长短可能会有很大影响。比如 1GHz 的 CPU，一个周期是 1/10 亿秒，在一个周期内，光只能前进 30 厘米。
- 存储器级别：

| 存储设备 |     大小     | 速度（CPU 时钟周期） |
| :------: | :----------: | :------------------: |
|  寄存器  | 4 或 8 bytes |         0.5          |
| L1-Cache | 几十到几百 K |         2~4          |
| L2-Cache |     ~2M      |        10~20         |
| L3-Cache |     ~16M     |        20~60         |
|   内存   |     ~16G     |       200~300        |

- 内存需要 200 的时钟周期，所以没办法跟上 CPU 速度，就有了多级缓存
- L1 分为数据区和指令区，可以协助指令预读
